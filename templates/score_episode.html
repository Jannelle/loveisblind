{% extends 'base.html' %}

{% block title %}
    Score Episode
{% endblock %}
{% block content %}
<body>
    <title>Episode {{ episode }}</title>
    <h3>Men</h3>
    <table class="specific-table">
        <tr>
            <th></th>
            {% for man in men %}  <th>{{ man.name }}</th>  {% endfor %}
        </tr>
        {% for activity in get_activities %}
            <tr>
                <td>{{ activity.name }}</td>
                {% for man in men %}
                    <td>
                        <button class="update-button" data-man="{{ man.id }}" data-activity="{{ activity.id }}">
                        <span class="activity-count">0</span>
                        </button>
                        
                    </td>
                {% endfor %}
            </tr>
        {% endfor %}
    </table>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var updateButtons = document.querySelectorAll('.update-button');

            updateButtons.forEach(function(button) {
                button.addEventListener('click', function() {
                    var man_id = this.getAttribute('data-man');
                    var activity_id = this.getAttribute('data-activity');
                    var episode = "{{ episode }}"; // Include the episode variable from the Flask template
                    console.log(man_id)
                    console.log(activity_id)
                    // Send the update to the backend
                    fetch('/increment_activity', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            participant_id: man_id,
                            activity_id: activity_id,
                            episode: episode
                        }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Handle the response if needed
                        console.log('Update successful:', data);
                        // Update the count in the corresponding span

                        var countSpan = this.querySelector('.activity-count');
                        countSpan.innerText = parseInt(countSpan.innerText) + 1;
                    })
                    .catch((error) => {
                        console.error('Error updating activity:', error);
                    })
                    ;
                });
            });
        });
    </script>
</body>
{% endblock %}